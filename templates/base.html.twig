{% extends 'base.html.twig' %}

{% block title %}Mon Profil Candidat{% endblock %}

{% block javascripts %}
    {{ parent() }}
{% endblock %}

{% block body %}
    <div class="card-body container">
        {% for label, messages in app.flashes %}
            {% for message in messages %}
                <div class="alert alert-{{ label }} alert-dismissible fade show">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endfor %}

        <h3 class="d-flex justify-content-between align-items-center">
            Informations personnelles
            {% if user.candidateProfileForCurrentEdition is null %}
                <a href="{{ path('candidate_start_candidate') }}" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-clipboard-list me-1"></i> Ma candidature
                </a>
            {% endif %}
        </h3>

        <dl class="row mb-4">
            <dt class="col-sm-3">Nom</dt>
            <dd class="col-sm-9">{{ user.lastName }}</dd>

            <dt class="col-sm-3">Prénom</dt>
            <dd class="col-sm-9">{{ user.firstName }}</dd>

            <dt class="col-sm-3">Email</dt>
            <dd class="col-sm-9">{{ user.email }}</dd>

            {% if not no_profile %}
                {% if profile.phone %}
                    <dt class="col-sm-3">Téléphone</dt>
                    <dd class="col-sm-9">{{ profile.phone }}</dd>
                {% endif %}
                {% if profile.address %}
                    <dt class="col-sm-3">Adresse</dt>
                    <dd class="col-sm-9">{{ profile.address }}</dd>
                {% endif %}
                {% if profile.dateOfBirth %}
                    <dt class="col-sm-3">Date de naissance</dt>
                    <dd class="col-sm-9">{{ profile.dateOfBirth|date('d/m/Y') }}</dd>
                {% endif %}
                {% if profile.nationality %}
                    <dt class="col-sm-3">Nationalité</dt>
                    <dd class="col-sm-9">{{ profile.nationality }}</dd>
                {% endif %}
            {% endif %}
        </dl>

        {% if not no_profile %}
            <h3>Informations académiques</h3>
            <dl class="row mb-4">
                {% if profile.school %}
                    <dt class="col-sm-3">École/Université</dt>
                    <dd class="col-sm-9">{{ profile.school }}</dd>
                {% endif %}
                {% if profile.courseName %}
                    <dt class="col-sm-3">Formation</dt>
                    <dd class="col-sm-9">{{ profile.courseName }}</dd>
                {% endif %}
                {% if profile.specialization %}
                    <dt class="col-sm-3">Spécialisation</dt>
                    <dd class="col-sm-9">{{ profile.specialization }}</dd>
                {% endif %}
                {% if profile.courseStartDate %}
                    <dt class="col-sm-3">Début de formation</dt>
                    <dd class="col-sm-9">{{ profile.courseStartDate|date('d/m/Y') }}</dd>
                {% endif %}
                {% if profile.courseYear %}
                    <dt class="col-sm-3">Année d'étude</dt>
                    <dd class="col-sm-9">{{ profile.courseYear }}</dd>
                {% endif %}
            </dl>

            {% if profile.studentCard %}
                <h3>Documents</h3>
                <dl class="row mb-4">
                    <dt class="col-sm-3">Carte d'étudiant</dt>
                    <dd class="col-sm-9">
                        <a href="{{ asset('uploads/student_cards/' ~ profile.studentCard) }}" target="_blank" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-id-card me-1"></i> Voir ma carte d'étudiant
                        </a>
                    </dd>
                </dl>
            {% endif %}

            {% if workflow_state is defined and workflow_state %}
                <div class="alert
                {% if workflow_state == 'step2_rejected' %}
                    alert-danger
                {% elseif workflow_state in ['application_selected', 'step2_approved'] %}
                    alert-success
                {% else %}
                    alert-info
                {% endif %} mt-4">

                    {% if workflow_state == 'step2_submitted' %}
                        <h4 class="alert-heading">Candidature en cours d'examen</h4>
                        <p>Votre candidature a été soumise et est en cours d'examen.</p>
                    {% elseif workflow_state == 'step2_approved' %}
                        <h4 class="alert-heading">Félicitations !</h4>
                        <p>Votre candidature a été approuvée.</p>
                    {% elseif workflow_state == 'step2_rejected' %}
                        <h4 class="alert-heading">Candidature refusée</h4>
                        <p>Votre candidature a été refusée. Vous pouvez la modifier.</p>
                        {% if can_edit %}
                            <div class="text-center mt-3">
                                <a href="{{ path('candidate_start_candidate') }}" class="btn btn-primary">
                                    <i class="fas fa-edit me-1"></i> Modifier ma candidature
                                </a>
                            </div>
                        {% endif %}
                    {% elseif workflow_state == 'application_selected' %}
                        <h4 class="alert-heading">Candidature acceptée !</h4>
                        <p>Nous reviendrons vers vous très bientôt.</p>
                    {% elseif workflow_state == 'application_rejected' %}
                        <h4 class="alert-heading">Candidature non retenue</h4>
                        <p>Nous vous encourageons à retenter une prochaine fois.</p>
                    {% endif %}
                </div>
            {% endif %}
        {% else %}
            <div class="alert alert-info mt-4">
                <h4 class="alert-heading">Vous n'avez pas encore de profil candidat</h4>
                <p>Pour postuler, cliquez sur le bouton ci-dessous.</p>
                <div class="text-center mt-3">
                    <a href="{{ path('candidate_start_candidate') }}" class="btn btn-primary">
                        <i class="fas fa-user-plus me-1"></i> Commencer ma candidature
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}
